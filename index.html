<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LyricFlow Pro - Editor de Video</title>
    <meta name="description" content="Editor profesional de videos con letras para redes sociales.">
    <!-- COI Service Worker for SharedArrayBuffer support -->
    <script src="coi-serviceworker.js"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Grotesk:wght@300;500;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Anime.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar / Control Panel -->
        <aside class="sidebar">
            <header class="logo-section">
                <div class="logo-icon"><i class="fa-solid fa-layer-group"></i></div>
                <h1>LyricFlow <span class="pro-badge">PRO</span></h1>
            </header>

            <div class="controls-wrapper">

                <!-- Tabs Navigation -->
                <div class="tabs-nav">
                    <button class="tab-btn active" data-tab="music"><i class="fa-solid fa-music"></i> Audio</button>
                    <button class="tab-btn" data-tab="background"><i class="fa-solid fa-image"></i> Fondo</button>
                    <button class="tab-btn" data-tab="text"><i class="fa-solid fa-font"></i> Texto</button>
                    <button class="tab-btn" data-tab="export"><i class="fa-solid fa-clapperboard"></i> Exportar</button>
                </div>

                <!-- TAB: MUSIC & LYRICS -->
                <div class="tab-content active" id="tab-music">
                    <div class="control-group">
                        <h3>Fuente de Audio</h3>
                        <div class="input-group">
                            <label for="audio-upload" class="file-card">
                                <div class="icon"><i class="fa-solid fa-file-audio"></i></div>
                                <div class="text">
                                    <span class="title">Subir MP3</span>
                                    <span class="subtitle" id="file-name">Sin archivo seleccionado</span>
                                </div>
                                <input type="file" id="audio-upload" accept="audio/*">
                            </label>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Letras</h3>
                        <div class="lyrics-tabs">
                            <button class="lyric-tab-btn active" data-lyric-tab="text">Texto / LRC</button>
                            <button class="lyric-tab-btn" data-lyric-tab="apple">Apple Karaoke</button>
                        </div>

                        <div id="lyric-content-text" class="lyric-tab-content active">
                            <div class="search-box input-with-btn">
                                <input type="text" id="track-search" placeholder="Artista - Canción">
                                <button id="search-btn"><i class="fa-solid fa-search"></i></button>
                            </div>
                            <textarea id="lyrics-input"
                                placeholder="Pega tu letra aquí... Soporta formato LRC con tiempos [00:12.50]"></textarea>
                        </div>

                        <div id="lyric-content-apple" class="lyric-tab-content">
                            <textarea id="apple-lyrics-input"
                                placeholder='Pega el JSON de Apple Music aquí... {"data": [...]}'></textarea>
                        </div>

                        <div class="separator-text">
                            <span>Opcional: Traducción</span>
                        </div>
                        <textarea id="lyrics-translation"
                            placeholder="Pega la traducción aquí (misma cantidad de líneas)..."></textarea>
                    </div>
                </div>

                <!-- TAB: BACKGROUND -->
                <div class="tab-content" id="tab-background">
                    <div class="control-group">
                        <h3>Medio de Fondo</h3>
                        <div class="input-group">
                            <label for="bg-upload" class="file-card">
                                <div class="icon"><i class="fa-solid fa-photo-film"></i></div>
                                <div class="text">
                                    <span class="title">Imagen o Video</span>
                                    <span class="subtitle" id="bg-file-name">Usando color sólido</span>
                                </div>
                                <input type="file" id="bg-upload" accept="image/*,video/*">
                            </label>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Reactividad de Audio</h3>
                        <div class="checkbox-group">
                            <label class="checkbox-card">
                                <input type="checkbox" id="audio-reactive-bg">
                                <span class="checkmark"></span>
                                Fondo Pulsante (Bass)
                            </label>
                        </div>
                        <div class="range-group">
                            <label>Intensidad de Reacción</label>
                            <input type="range" id="beat-intensity" min="0" max="100" value="50">
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Visualizador de Audio (Waveform)</h3>
                        <select id="viz-style" class="styled-select">
                            <option value="none">Desactivado</option>
                            <option value="bars">Barras Clásicas</option>
                            <option value="wave">Onda Suave</option>
                            <option value="circle">Circular</option>
                        </select>
                        <div class="color-row" style="margin-top:0.5rem">
                            <div class="color-input" style="width:100%">
                                <label>Color Viz</label>
                                <input type="color" id="viz-color" value="#ffffff">
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Ajustes de Fondo</h3>
                        <div class="range-group">
                            <label>Desenfoque (Blur) <span id="val-blur">0px</span></label>
                            <input type="range" id="bg-blur" min="0" max="20" value="0">
                        </div>
                        <div class="range-group">
                            <label>Oscuridad (Darken) <span id="val-darken">50%</span></label>
                            <input type="range" id="bg-darken" min="0" max="90" value="50">
                        </div>
                        <div class="range-group">
                            <label>Escala (Zoom) <span id="val-scale">100%</span></label>
                            <input type="range" id="bg-scale" min="100" max="150" value="100">
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Efectos Globales</h3>
                        <div class="checkbox-group">
                            <label class="checkbox-card">
                                <input type="checkbox" id="fx-particles">
                                <span class="checkmark"></span>
                                Partículas
                            </label>
                            <label class="checkbox-card">
                                <input type="checkbox" id="fx-vignette" checked>
                                <span class="checkmark"></span>
                                Viñeta
                            </label>
                            <label class="checkbox-card">
                                <input type="checkbox" id="fx-grain">
                                <span class="checkmark"></span>
                                Ruido Films
                            </label>
                        </div>
                    </div>
                </div>

                <!-- TAB: TEXT & STYLES -->
                <div class="tab-content" id="tab-text">
                    <div class="control-group">
                        <h3>Estilo Visual</h3>
                        <div class="style-grid">
                            <div class="style-option active" data-style="neon">Neon</div>
                            <div class="style-option" data-style="bold">Bold</div>
                            <div class="style-option" data-style="serif">Elegant</div>
                            <div class="style-option" data-style="arcade">Arcade</div>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Animación de Entrada</h3>
                        <select id="text-animation" class="styled-select">
                            <option value="fade">Desvanecer (Fade)</option>
                            <option value="slide-up">Deslizar Arriba</option>
                            <option value="zoom-in">Zoom In</option>
                            <option value="typewriter">Máquina de Escribir</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <h3>Apariencia</h3>
                        <div class="color-row">
                            <div class="color-input">
                                <label>Texto</label>
                                <input type="color" id="text-color" value="#ffffff">
                            </div>
                            <div class="color-input">
                                <label>Acento</label>
                                <input type="color" id="accent-color" value="#00f3ff">
                            </div>
                        </div>

                        <div class="control-group">
                            <h3>Partículas & Efectos</h3>
                            <select id="particle-theme" class="styled-select">
                                <option value="standard">Estándar (Subir)</option>
                                <option value="fire">Fuego (Intenso)</option>
                                <option value="snow">Nieve (Caer)</option>
                                <option value="stars">Estrellas (Parallax)</option>
                            </select>
                            <div class="color-row" style="margin-top:0.5rem">
                                <div class="color-input" style="width:100%">
                                    <label>Color Partículas</label>
                                    <input type="color" id="particle-color" value="#ffe400">
                                </div>
                            </div>
                            <div class="range-group" style="margin-top: 0.5rem">
                                <label>Tamaño Partículas <span id="val-part-size">100%</span></label>
                                <input type="range" id="particle-size" min="50" max="250" value="100">
                            </div>
                            <div class="range-group" style="margin-top: 0.5rem">
                                <label>Velocidad Partículas <span id="val-part-speed">100%</span></label>
                                <input type="range" id="particle-speed" min="10" max="300" value="100">
                            </div>
                        </div>

                        <div class="color-row">
                            <div class="color-input" style="flex: 0 0 100%;">
                                <label>Sombra / Brillo</label>
                                <input type="color" id="shadow-color" value="#bc13fe" style="width:100%">
                            </div>
                        </div>

                        <div class="range-group">
                            <label>Tamaño Letra Principal</label>
                            <input type="range" id="font-size" min="20" max="120" value="50">
                        </div>

                        <!-- Translation Settings -->
                        <div class="control-group"
                            style="margin-top: 1.5rem; border-top: 1px solid var(--border); padding-top: 1rem;">
                            <h3>Ajustes Traducción</h3>
                            <div class="input-group">
                                <label>Fuente Traducción</label>
                                <select id="trans-font" class="styled-select">
                                    <option value="inherit">Igual a Principal</option>
                                    <option value="Outfit">Outfit (Moderna)</option>
                                    <option value="serif">Elegant (Serif)</option>
                                    <option value="Courier New">Retro (Mono)</option>
                                    <option value="cursive">Manuscrita</option>
                                </select>
                            </div>
                            <div class="range-group">
                                <label>Tamaño Traducción <span id="val-trans-size">60%</span></label>
                                <input type="range" id="trans-size" min="30" max="100" value="60">
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Información y Marca</h3>
                        <div class="input-group">
                            <label>Créditos</label>
                            <input type="text" id="meta-artist" placeholder="Artista" style="margin-bottom: 0.5rem">
                            <input type="text" id="meta-song" placeholder="Canción">
                        </div>
                        <div class="input-group">
                            <label for="watermark-upload" class="file-card">
                                <div class="icon"><i class="fa-solid fa-stamp"></i></div>
                                <div class="text">
                                    <span class="title">Sello de Agua (PNG)</span>
                                    <span class="subtitle" id="wm-file-name">Opcional</span>
                                </div>
                                <input type="file" id="watermark-upload" accept="image/png,image/jpeg">
                            </label>
                            <div class="range-group" style="margin-top: 0.5rem">
                                <label>Opacidad Sello</label>
                                <input type="range" id="wm-opacity" min="10" max="100" value="80">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: EXPORT -->
                <div class="tab-content" id="tab-export">
                    <div class="info-box">
                        <i class="fa-solid fa-circle-info"></i>
                        <p>Para sincronizar, presiona "Grabar Sincronización" y toca la tecla <strong>ESPACIO</strong> o
                            el botón <strong>TAP</strong> al inicio de cada frase.</p>
                    </div>

                    <div class="sync-controls">
                        <button id="sync-mode-btn" class="btn primary large-btn">
                            <i class="fa-solid fa-microphone-lines"></i> Grabar Sincronización
                        </button>
                    </div>

                    <!-- Correction Editor -->
                    <div id="timeline-editor" class="timeline-container">
                        <!-- JS injected rows -->
                    </div>

                    <div class="control-group">
                        <h3>Rango de Grabación</h3>
                        <div class="range-inputs">
                            <div class="input-field">
                                <label>Inicio (seg)</label>
                                <div class="input-with-btn">
                                    <input type="number" id="export-start" value="0" step="0.1" min="0">
                                    <button class="small-btn" id="set-start-btn" title="Usar tiempo actual"><i
                                            class="fa-solid fa-clock"></i></button>
                                </div>
                            </div>
                            <div class="input-field">
                                <label>Fin (seg)</label>
                                <div class="input-with-btn">
                                    <input type="number" id="export-end" value="0" step="0.1" min="0">
                                    <button class="small-btn" id="set-end-btn" title="Usar tiempo actual"><i
                                            class="fa-solid fa-clock"></i></button>
                                </div>
                            </div>
                        </div>
                        <p class="small-info">Deja en 0 para grabar desde el inicio hasta el final.</p>
                    </div>

                    <div class="export-actions">
                        <button id="preview-btn" class="btn secondary">
                            <i class="fa-solid fa-play"></i> Vista Previa
                        </button>
                        <button id="popup-btn" class="btn secondary">
                            <i class="fa-solid fa-up-right-from-square"></i> Modo OBS (Popup)
                        </button>
                        <button id="export-btn" class="btn accent">
                            <i class="fa-solid fa-file-export"></i> Renderizar Video
                        </button>
                    </div>
                    <div id="status-msg" class="status-console">Listo para crear.</div>
                </div>

            </div>
        </aside>

        <!-- Main Workspace -->
        <main class="workspace">
            <div class="canvas-container">
                <canvas id="video-canvas" width="1080" height="1920"></canvas>

                <!-- Playback Controls Overlay -->
                <div class="playback-bar">
                    <button id="play-pause-btn"><i class="fa-solid fa-play"></i></button>
                    <div class="progress-track" id="progress-track">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <span class="time-code" id="time-code">00:00</span>
                    <div class="volume-control">
                        <i class="fa-solid fa-volume-high"></i>
                        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1">
                    </div>
                </div>

                <!-- Sync Overlay -->
                <div id="sync-overlay" class="sync-overlay hidden">
                    <div class="sync-header">GRABANDO SINCRONIZACIÓN</div>
                    <div class="sync-target-box">
                        <div class="sync-prev">...</div>
                        <div class="sync-current" id="sync-current-text">Presiona TAP para iniciar</div>
                        <div class="sync-next" id="sync-next-text">Próxima línea...</div>
                    </div>
                    <button id="tap-btn" class="tap-huge-btn">TAP</button>
                    <button id="stop-sync-btn" class="stop-sync-btn">Finalizar / Guardar</button>
                </div>
            </div>
        </main>
    </div>

    <script src="script.js"></script>
</body>

</html>